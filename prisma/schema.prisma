// Studesq Database Schema
// SQLite for MVP - easy local development, no external dependencies

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// User roles enum
enum UserRole {
  STUDENT
  PARENT
  ADMIN
}

// Achievement types enum
enum AchievementType {
  ACADEMIC
  EXTRACURRICULAR
  CERTIFICATION
  COMPETITION
  PROJECT
  OTHER
}

// =============================================================================
// Core Models
// =============================================================================

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String
  role      UserRole @default(STUDENT)
  
  // OAuth fields (null for mock auth users)
  googleId  String?  @unique
  
  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  studentProfile StudentProfile?
  parentLinks    ParentLink[]    @relation("ParentUser")
  
  @@index([email])
  @@index([googleId])
}

model StudentProfile {
  id          String   @id @default(cuid())
  userId      String   @unique
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Display information
  displayName String
  bio         String?
  avatarUrl   String?
  
  // Academic information
  school      String?
  grade       String?
  dob         DateTime?
  
  // Early founder status
  earlyFounder Boolean @default(false)
  
  // Metadata
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  achievements Achievement[]
  parentLinks  ParentLink[]   @relation("StudentProfile")
  
  @@index([userId])
}

model Achievement {
  id          String          @id @default(cuid())
  studentId   String
  student     StudentProfile  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  
  // Achievement details
  title       String
  description String
  type        AchievementType @default(OTHER)
  
  // Date of achievement
  date        DateTime
  
  // Certificate/proof document
  certificatePath String?
  
  // Metadata
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([studentId])
  @@index([date])
}

model ParentLink {
  id           String         @id @default(cuid())
  studentId    String
  student      StudentProfile @relation("StudentProfile", fields: [studentId], references: [id], onDelete: Cascade)
  
  parentUserId String
  parent       User           @relation("ParentUser", fields: [parentUserId], references: [id], onDelete: Cascade)
  
  // Verification status
  verified     Boolean        @default(true)
  
  // Metadata
  createdAt    DateTime       @default(now())
  
  @@unique([studentId, parentUserId])
  @@index([studentId])
  @@index([parentUserId])
}

model Opportunity {
  id          String   @id @default(cuid())
  
  // Opportunity details
  title       String
  description String
  provider    String
  externalUrl String
  
  // Date/deadline
  date        DateTime
  
  // Metadata
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([date])
}

// Optional: Waitlist signups
model WaitlistSignup {
  id        String   @id @default(cuid())
  email     String   @unique
  createdAt DateTime @default(now())
  
  @@index([email])
}
